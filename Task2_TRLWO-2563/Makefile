DEFAULT_CFLAGS = -std=gnu11 -g3 -Wall -Wextra -pedantic -Werror

PARSON_ROOT = utilities/parson
PARSON_TARGETS = $(PARSON_ROOT)/parson.o
PARSON_PREREQ = $(PARSON_ROOT)/parson.h $(PARSON_ROOT)/parson.c Makefile
PARSON_CFLAGS = $(DEFAULT_CFLAGS)

SERVER_PARSER_TARGETS = server_config.o
SERVER_PARSER_PREREQ = $(SERVER_PARSER_TARGETS:.o=.c) $(SERVER_PARSER_TARGETS:.o=.h) $(PARSON_TARGETS) Makefile
SERVER_PARSER_CFLAGS = $(DEFAULT_CFLAGS)

HC_HTTP_PARSER_TARGETS = hc_http_parser.o
HC_HTTP_PARSER_PREREQ  = $(HC_HTTP_PARSER_TARGETS:.o=.c) hc_string.h
HC_HTTP_PARSER_CFLAGS  = $(DEFAULT_CFLAGS)
 
RELEASE_TARGETS = http_server
RELEASE_PREREQ  = $(addsuffix .c, $(RELEASE_TARGETS)) $(SERVER_PARSER_TARGETS) $(HC_HTTP_PARSER_TARGETS) hc_string.h hc_list.h hc_address.h hc_event_handler.h
RELEASE_CFLAGS  = $(DEFAULT_CFLAGS) -D_LARGEFILE64_SOURCE

CLEANUP_TARGETS  = $(RELEASE_TARGETS) $(SERVER_PARSER_TARGETS) $(PARSON_TARGETS) $(HC_HTTP_PARSER_TARGETS)

$(RELEASE_TARGETS): $(RELEASE_PREREQ)
	$(CC) -o $@ $@.c $(SERVER_PARSER_TARGETS) $(PARSON_TARGETS) $(HC_HTTP_PARSER_TARGETS) $(RELEASE_CFLAGS)

$(SERVER_PARSER_TARGETS): $(SERVER_PARSER_PREREQ)
	$(CC) -o $@ -c $(filter %.c, $^)  $(SERVER_PARSER_CFLAGS) 

$(PARSON_TARGETS): $(PARSON_PREREQ)
	$(CC) -o $@ -c $(patsubst %.o, %.c, $@) $(PARSON_CFLAGS)

$(HC_HTTP_PARSER_TARGETS): $(HC_HTTP_PARSER_PREREQ)
	$(CC) -o $@ -c $(patsubst %.o, %.c, $@) $(HC_HTTP_PARSER_CFLAGS)

clean:
	rm $(CLEANUP_TARGETS)
